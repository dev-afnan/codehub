<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
body { font-family:sans-serif; max-width:800px; margin:auto; padding:20px; }
h2 { text-align:center; }
#loginPrompt { text-align:center; margin-top:20px; }
#conversationList { margin-top:20px; display:none; }
.conversation { border:1px solid #ccc; border-radius:5px; padding:10px; margin-bottom:10px; cursor:pointer; }
#messages { border:1px solid #ccc; border-radius:5px; padding:10px; height:400px; overflow-y:auto; margin-bottom:20px; display:flex; flex-direction:column; }
.message { margin:5px 0; padding:6px 10px; border-radius:5px; max-width:75%; }
.user { background:#e1f5fe; align-self:flex-start; }
.admin { background:#c8e6c9; align-self:flex-end; margin-left:auto; }
form { display:flex; gap:10px; }
input[type=text] { flex:1; padding:8px; border:1px solid #ccc; border-radius:5px; }
button { padding:8px 16px; cursor:pointer; background:#007bff; border:none; color:#fff; border-radius:5px; }
button:hover { background:#0056b3; }
</style>
</head>
<body>
<h2>Admin Panel</h2>

<div id="loginPrompt">
  <button id="googleLoginBtn">Sign in with Google</button>
</div>

<div id="conversationList"></div>

<div id="conversationArea" style="display:none;">
  <h3>Conversation</h3>
  <div id="messages"></div>
  <form id="replyForm">
    <input type="text" id="replyMessage" placeholder="Type your reply..." required>
    <button type="submit">Send</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDxMO7-n_ZXp-axX4wBRV8hsVfRmI-aVcM",
  authDomain: "afnanix-contact-form.firebaseapp.com",
  projectId: "afnanix-contact-form",
  storageBucket: "afnanix-contact-form.firebasestorage.app",
  messagingSenderId: "994386258441",
  appId: "1:994386258441:web:5e1b2b412a3778845da6d8",
  measurementId: "G-1TNH5G7SE4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Sign in anonymously if not already signed in
onAuthStateChanged(auth, (user) => {
  if (!user) {
    signInAnonymously(auth)
      .then(() => console.log("Signed in anonymously"))
      .catch((err) => console.error("Anonymous sign-in error:", err));
  }
});

// Handle form submission
document.querySelector("form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const topic = document.getElementById("topic").value;
  const message = document.getElementById("message").value.trim();

  if (!name || !email || !message) {
    alert("Please fill all required fields.");
    return;
  }

  try {
    const convDoc = await addDoc(collection(db, "conversations"), {
      name,
      email,
      topic,
      messages: [
        { sender: "user", text: message, timestamp: serverTimestamp() }
      ],
      createdAt: serverTimestamp()
    });

    const link = `${window.location.origin}/contact-form/response.html?id=${convDoc.id}`;
    alert(`Your message was submitted! Please save or bookmark this link to see replies:\n${link}`);

    // Clear form
    e.target.reset();

  } catch (err) {
    console.error("Error creating conversation:", err);
    alert("There was an error submitting your message. Please try again.");
  }
});
</script>
</body>
  </html>
