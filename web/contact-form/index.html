<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact Form</title>
<style>
  body { font-family: sans-serif; max-width:700px; margin:auto; padding:20px; }
  label { display:block; margin-top:15px; font-weight:bold; }
  input, select, textarea { width:100%; padding:8px; margin-top:5px; box-sizing:border-box; }
  button { margin-top:20px; padding:10px 15px; }
  #confirmation { margin-top:20px; padding:10px; background:#f0f0f0; border-radius:6px; display:none; }
  #confirmation a { color:#00abff; word-break:break-all; }
</style>
</head>
<body>
<h2>Contact Me</h2>
<form id="contactForm">
  <label for="name">Your Name</label>
  <input type="text" id="name" name="name" required>

  <label for="email">Your Email</label>
  <input type="email" id="email" name="email" required>

  <label for="topic">Topic</label>
  <select id="topic" name="topic" required>
    <option value="question">General Question‚ùì</option>
    <option value="feedback">Feedback ‚ù§Ô∏è</option>
    <option value="suggestion">Suggestion ‚ú®</option>
    <option value="other">Other ü§î</option>
  </select>

  <label for="message">Your Message</label>
  <textarea id="message" name="message" rows="6" required></textarea>

  <button type="submit">Submit</button>
</form>

<div id="confirmation">
  <p>Save or bookmark this link to see my response:</p>
  <p id="link"></p>
  <p>Password: <span id="password"></span></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDxMO7-n_ZXp-axX4wBRV8hsVfRmI-aVcM",
  authDomain: "afnanix-contact-form.firebaseapp.com",
  projectId: "afnanix-contact-form",
  storageBucket: "afnanix-contact-form.firebasestorage.app",
  messagingSenderId: "994386258441",
  appId: "1:994386258441:web:5e1b2b412a3778845da6d8",
  measurementId: "G-1TNH5G7SE4"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("contactForm");
const confirmation = document.getElementById("confirmation");
const linkEl = document.getElementById("link");
const passwordEl = document.getElementById("password");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  // Get form values
  const name = form.name.value.trim();
  const email = form.email.value.trim();
  const topic = form.topic.value;
  const message = form.message.value.trim();

  // Generate unique conversation ID & password
  const convId = crypto.randomUUID();
  const password = Math.random().toString(36).slice(-8);

  // Reference to Firestore doc
  const convRef = doc(db, "conversations", convId);

  // Save to Firestore
  try {
    await setDoc(convRef, {
      id: convId,
      name,
      email,
      topic,
      messages: [{ sender: "user", text: message }],
      password,
      createdAt: serverTimestamp()
    });

    // Clear form
    form.reset();

    // Show confirmation with link & password
    const convLink = `${window.location.origin}/contact-form/response.html?id=${convId}`;
    linkEl.innerHTML = `<a href="${convLink}" target="_blank">${convLink}</a>`;
    passwordEl.textContent = password;
    confirmation.style.display = "block";

  } catch (err) {
    console.error("Error saving conversation:", err);
    alert("There was an error submitting your message. Please try again.");
  }
});
</script>
</body>
</html>
